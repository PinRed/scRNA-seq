head(COAD.Clinical)
COAD.Clinical<-read.table(file="survival_COAD_survival.txt",sep="\t",head=TRUE,quote = "\"")
head(COAD.Clinical)
TCGA.temp2<-read.table(file="TCGA.COAD.sampleMap_HiSeqV2.data",sep="\t",head=TRUE,quote = "\"")
head(COAD.Clinical2[,1:10])
TCGA.temp2<-read.table(file="TCGA.COAD.sampleMap_HiSeqV2.data",sep="\t",head=TRUE,quote = "\"")
head(COAD.Clinical2[,1:10])
head(COAD.Clinical2[,1:10])
head(COAD.Clinical)
head(COAD.Clinical)
head(COAD.Clinical2[,1:10])
head(COAD.Clinical2[,1:10])
COAD.Clinical2<-read.table(file="TCGA.COAD.sampleMap_COAD_clinicalMatrix",sep="\t",head=TRUE,quote = "\"")
head(COAD.Clinical2[,1:10])
head(COAD.Clinical2[,1:10])
TCGA.temp2<-read.table(file="TCGA.COAD.sampleMap_HiSeqV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp2[,1:10])
TCGA.temp<-read.table(file="TCGA.COAD.sampleMap_GAV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp[,1:10])
dim(TCGA.temp)
dim(TCGA.temp2)
sum(COAD.T.index!=0)
source("C:/Users/User/Desktop/program/utaipei_RA/code_TCGA_CRC_forWillie.r/code_TCGA_CRC_forWillie.r", echo = TRUE)
<<<<<<< HEAD
=======
##### View survival_COAD_survival.txt  #####
COAD.Clinical<-read.table(file="data/survival_COAD_survival.txt",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical)
colnames(COAD.Clinical)
head(COAD.Clinical)
colSums(is.na(COAD.Clinical[colSums(is.na(COAD.Clinical)) > 0]))
##### View TCGA.COAD.sampleMap_COAD_clinicalMatrix  #####
COAD.Clinical2<-read.table(file="data/TCGA.COAD.sampleMap_COAD_clinicalMatrix",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical2)
colnames(COAD.Clinical2)
head(COAD.Clinical2[,1:10])
colSums(is.na(COAD.Clinical2[colSums(is.na(COAD.Clinical2)) > 0]))
# 1. 基本病人資料
basic_info <- c(
"sampleID", "patient_id", "bcr_patient_barcode", "bcr_sample_barcode", "bcr_followup_barcode",
"gender", "age_at_initial_pathologic_diagnosis", "days_to_birth", "days_to_death",
"days_to_last_followup", "vital_status", "height", "weight", "initial_weight",
"year_of_initial_pathologic_diagnosis", "system_version", "form_completion_date"
)
# 2. 分子與基因相關資訊
molecular_gene <- c(
"MSI_updated_Oct62011", "microsatellite_instability", "CIMP",
"braf_gene_analysis_performed", "braf_gene_analysis_result",
"kras_gene_analysis_performed", "kras_mutation_found", "kras_mutation_codon",
"hypermutation", "loss_expression_of_mismatch_repair_proteins_by_ihc",
"loss_expression_of_mismatch_repair_proteins_by_ihc_result",
"non_silent_mutation", "silent_mutation", "total_mutation",
"non_silent_rate_per_Mb", "silent_rate_per_Mb",
"number_of_abnormal_loci", "number_of_loci_tested"
)
# 3. 臨床診斷與病理
clinical_pathology <- c(
"primary_site", "tumor_tissue_site", "anatomic_neoplasm_subdivision",
"histological_type", "pathologic_T", "pathologic_N", "pathologic_M",
"pathologic_stage", "residual_tumor",
"residual_disease_post_new_tumor_event_margin_status",
"circumferential_resection_margin", "perineural_invasion_present",
"lymphatic_invasion", "venous_invasion",
"lymph_node_examined_count", "number_of_lymphnodes_positive_by_he",
"number_of_lymphnodes_positive_by_ihc", "non_nodal_tumor_deposits", "pathology_report_file_name", "primary_lymph_node_presentation_assessment"
)
# 4. 治療與追蹤
treatment_followup <- c(
"radiation_therapy", "additional_radiation_therapy", "additional_pharmaceutical_therapy",
"postoperative_rx_tx", "preoperative_pretreatment_cea_level",
"primary_therapy_outcome_success", "followup_treatment_success",
"person_neoplasm_cancer_status",
"new_tumor_event_after_initial_treatment", "new_neoplasm_event_type",
"new_tumor_event_additional_surgery_procedure",
"days_to_new_tumor_event_after_initial_treatment",
"days_to_new_tumor_event_additional_surgery_procedure",
"history_of_neoadjuvant_treatment", "lost_follow_up",
"followup_case_report_form_submission_reason", "site_of_additional_surgery_new_tumor_event_mets"
)
# 5. 其他病史與檢查
history_other <- c(
"history_of_colon_polyps", "colon_polyps_present", "synchronous_colon_cancer_present",
"number_of_first_degree_relatives_with_cancer_diagnosis",
"icd_10", "icd_o_3_histology", "icd_o_3_site",
"informed_consent_verified",
"AWG_MLH1_silencing", "AWG_cancer_type_Oct62011", "CDE_ID_3226963", "disease_code"
)
# 6. TCGA 整合與多組學欄位
tcga_multiomics <- c(
grep("^X_", colnames(COAD.Clinical2), value = TRUE),  # 所有 X_ 開頭的欄位
"project_code", "X_cohort", "X_primary_disease", "X_primary_site"
)
# 7. 樣本/檢體資訊
sample_info <- c(
"days_to_collection", "days_to_initial_pathologic_diagnosis", "intermediate_dimension", "longest_dimension", "shortest_dimension",
"is_ffpe", "oct_embedded", "sample_type", "sample_type_id",
"tissue_prospective_collection_indicator", "tissue_retrospective_collection_indicator",
"tissue_source_site", "vial_number"
)
# === Split to 6 data.frame ===
COAD_basic      <- COAD.Clinical2[, basic_info]
COAD_molecular  <- COAD.Clinical2[, molecular_gene]
COAD_pathology  <- COAD.Clinical2[, clinical_pathology]
COAD_treatment  <- COAD.Clinical2[, treatment_followup]
COAD_history    <- COAD.Clinical2[, history_other]
COAD_multiomics <- COAD.Clinical2[, tcga_multiomics]
#### TCGA.COAD.sampleMap_HiSeqV2 AND TCGA.COAD.sampleMap_GAV2 ####
TCGA.temp2<-read.table(file="data/TCGA.COAD.sampleMap_HiSeqV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp2[,1:10])
TCGA.temp<-read.table(file="data/TCGA.COAD.sampleMap_GAV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp[,1:10])
dim(TCGA.temp)
dim(TCGA.temp2)
# Match tumor cells by patient
COAD.T.index <- match(unique(paste0(COAD.Clinical$X_PATIENT, "-01")), COAD.Clinical$sample, nomatch = 0)
sum(COAD.T.index != 0)  # Count how many tumor samples were successfully matched
# Match normal cells by patient
COAD.N.index <- match(unique(paste0(COAD.Clinical$X_PATIENT, "-11")), COAD.Clinical$sample, nomatch = 0)
sum(COAD.N.index != 0)  # Count how many normal samples were successfully matched
# Find patients who have both tumor and normal cells
COAD.matchT.index <- match(unique(paste0(COAD.Clinical$X_PATIENT[COAD.N.index], "-01")), COAD.Clinical$sample, nomatch = 0)
cbind(COAD.Clinical$sample[COAD.matchT.index], COAD.Clinical$sample[COAD.N.index])  # Combine matched tumor-normal sample pairs
# Extract tumor patient clinical data
COAD.Clinical.T <- COAD.Clinical[COAD.T.index,]
# Identify the patient's tumor cells using GAV2
common.names <- intersect(substr(colnames(TCGA.temp), 1, 15), make.names(COAD.Clinical.T$sample))
common.names
length(common.names)  # Count common names
# Identify the patient's tumor cells using HiSeqV2
common.names2 <- intersect(substr(colnames(TCGA.temp2), 1, 15), make.names(COAD.Clinical.T$sample))
common.names2
length(common.names2)  # Count common names
# Identify the patient's normal cells using HiSeqV2
common.namesN <- intersect(substr(colnames(TCGA.temp2), 1, 15), make.names(COAD.Clinical$sample[COAD.N.index]))
common.namesN
length(common.namesN)  # Count common names
#### Clustering ####
library(DESeq2)
tumor.counts <- TCGA.temp2[, common.names2]
normal.counts <- TCGA.temp2[, common.namesN]
all.counts <- cbind(tumor.counts, normal.counts)
sample.type <- c(rep("Tumor", length(common.names2)), rep("Normal", length(common.namesN)))
colData <- data.frame(row.names = colnames(all.counts), condition = sample.type)
dds <- DESeqDataSetFromMatrix(
countData = round(all.counts),
colData = colData,
design = ~ condition
)
# 執行 DESeq 分析
dds <- DESeq(dds)
# 取得差異基因表現的結果
res <- results(dds)
summary(res)
View(dds)
assay(dds)
rld_matrix <- assay(dds)
View(rld_matrix)
dim(rld_matrix)
# 轉置矩陣，讓樣本 (samples) 成為行，基因 (genes) 成為列
data_for_umap <- t(rld_matrix)
# 執行 UMAP 降維
umap_result <- umap(data_for_umap)
# 將 UMAP 結果與樣本資訊結合
umap_df <- as.data.frame(umap_result$layout)
colnames(umap_df) <- c("UMAP1", "UMAP2")
umap_df$condition <- colData$condition
# 繪製 UMAP 圖
ggplot(umap_df, aes(x = UMAP1, y = UMAP2, color = condition)) +
geom_point(size = 3, alpha = 0.8) +
labs(
title = "UMAP of TCGA Colon Cancer Samples",
subtitle = "Tumor vs. Normal Samples"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)
)
# 載入必要的套件
# 如果尚未安裝，請先執行 install.packages("umap")
library(umap)
library(ggplot2)
# 轉置矩陣，讓樣本 (samples) 成為行，基因 (genes) 成為列
data_for_umap <- t(rld_matrix)
# 執行 UMAP 降維
umap_result <- umap(data_for_umap)
# 將 UMAP 結果與樣本資訊結合
umap_df <- as.data.frame(umap_result$layout)
colnames(umap_df) <- c("UMAP1", "UMAP2")
umap_df$condition <- colData$condition
# 繪製 UMAP 圖
ggplot(umap_df, aes(x = UMAP1, y = UMAP2, color = condition)) +
geom_point(size = 3, alpha = 0.8) +
labs(
title = "UMAP of TCGA Colon Cancer Samples",
subtitle = "Tumor vs. Normal Samples"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5)
)
##### View TCGA.COAD.sampleMap_COAD_clinicalMatrix  #####
COAD.Clinical2<-read.table(file="data/TCGA.COAD.sampleMap_COAD_clinicalMatrix",sep="\t",head=TRUE,quote = "\"")
##### View survival_COAD_survival.txt  #####
COAD.Clinical<-read.table(file="data/survival_COAD_survival.txt",sep="\t",head=TRUE,quote = "\"")
##### View TCGA.COAD.sampleMap_COAD_clinicalMatrix  #####
COAD.Clinical2<-read.table(file="data/TCGA.COAD.sampleMap_COAD_clinicalMatrix",sep="\t",head=TRUE,quote = "\"")
##### View survival_COAD_survival.txt  #####
COAD.Clinical<-read.table(file="data/survival_COAD_survival.txt",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical)
colnames(COAD.Clinical)
head(COAD.Clinical)
colSums(is.na(COAD.Clinical[colSums(is.na(COAD.Clinical)) > 0]))
##### View TCGA.COAD.sampleMap_COAD_clinicalMatrix  #####
COAD.Clinical2<-read.table(file="data/TCGA.COAD.sampleMap_COAD_clinicalMatrix",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical2)
colnames(COAD.Clinical2)
head(COAD.Clinical2[,1:10])
colSums(is.na(COAD.Clinical2[colSums(is.na(COAD.Clinical2)) > 0]))
# 1. 基本病人資料
basic_info <- c(
"sampleID", "patient_id", "bcr_patient_barcode", "bcr_sample_barcode", "bcr_followup_barcode",
"gender", "age_at_initial_pathologic_diagnosis", "days_to_birth", "days_to_death",
"days_to_last_followup", "vital_status", "height", "weight", "initial_weight",
"year_of_initial_pathologic_diagnosis", "system_version", "form_completion_date"
)
# 2. 分子與基因相關資訊
molecular_gene <- c(
"MSI_updated_Oct62011", "microsatellite_instability", "CIMP",
"braf_gene_analysis_performed", "braf_gene_analysis_result",
"kras_gene_analysis_performed", "kras_mutation_found", "kras_mutation_codon",
"hypermutation", "loss_expression_of_mismatch_repair_proteins_by_ihc",
"loss_expression_of_mismatch_repair_proteins_by_ihc_result",
"non_silent_mutation", "silent_mutation", "total_mutation",
"non_silent_rate_per_Mb", "silent_rate_per_Mb",
"number_of_abnormal_loci", "number_of_loci_tested"
)
# 3. 臨床診斷與病理
clinical_pathology <- c(
"primary_site", "tumor_tissue_site", "anatomic_neoplasm_subdivision",
"histological_type", "pathologic_T", "pathologic_N", "pathologic_M",
"pathologic_stage", "residual_tumor",
"residual_disease_post_new_tumor_event_margin_status",
"circumferential_resection_margin", "perineural_invasion_present",
"lymphatic_invasion", "venous_invasion",
"lymph_node_examined_count", "number_of_lymphnodes_positive_by_he",
"number_of_lymphnodes_positive_by_ihc", "non_nodal_tumor_deposits", "pathology_report_file_name", "primary_lymph_node_presentation_assessment"
)
# 4. 治療與追蹤
treatment_followup <- c(
"radiation_therapy", "additional_radiation_therapy", "additional_pharmaceutical_therapy",
"postoperative_rx_tx", "preoperative_pretreatment_cea_level",
"primary_therapy_outcome_success", "followup_treatment_success",
"person_neoplasm_cancer_status",
"new_tumor_event_after_initial_treatment", "new_neoplasm_event_type",
"new_tumor_event_additional_surgery_procedure",
"days_to_new_tumor_event_after_initial_treatment",
"days_to_new_tumor_event_additional_surgery_procedure",
"history_of_neoadjuvant_treatment", "lost_follow_up",
"followup_case_report_form_submission_reason", "site_of_additional_surgery_new_tumor_event_mets"
)
# 5. 其他病史與檢查
history_other <- c(
"history_of_colon_polyps", "colon_polyps_present", "synchronous_colon_cancer_present",
"number_of_first_degree_relatives_with_cancer_diagnosis",
"icd_10", "icd_o_3_histology", "icd_o_3_site",
"informed_consent_verified",
"AWG_MLH1_silencing", "AWG_cancer_type_Oct62011", "CDE_ID_3226963", "disease_code"
)
# 6. TCGA 整合與多組學欄位
tcga_multiomics <- c(
grep("^X_", colnames(COAD.Clinical2), value = TRUE),  # 所有 X_ 開頭的欄位
"project_code", "X_cohort", "X_primary_disease", "X_primary_site"
)
# 7. 樣本/檢體資訊
sample_info <- c(
"days_to_collection", "days_to_initial_pathologic_diagnosis", "intermediate_dimension", "longest_dimension", "shortest_dimension",
"is_ffpe", "oct_embedded", "sample_type", "sample_type_id",
"tissue_prospective_collection_indicator", "tissue_retrospective_collection_indicator",
"tissue_source_site", "vial_number"
)
# === Split to 6 data.frame ===
COAD_basic      <- COAD.Clinical2[, basic_info]
COAD_molecular  <- COAD.Clinical2[, molecular_gene]
COAD_pathology  <- COAD.Clinical2[, clinical_pathology]
COAD_treatment  <- COAD.Clinical2[, treatment_followup]
COAD_history    <- COAD.Clinical2[, history_other]
COAD_multiomics <- COAD.Clinical2[, tcga_multiomics]
#### TCGA.COAD.sampleMap_HiSeqV2 AND TCGA.COAD.sampleMap_GAV2 ####
TCGA.temp2<-read.table(file="data/TCGA.COAD.sampleMap_HiSeqV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp2[,1:10])
TCGA.temp<-read.table(file="data/TCGA.COAD.sampleMap_GAV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp[,1:10])
dim(TCGA.temp)
dim(TCGA.temp2)
# Match tumor cells by patient
COAD.T.index <- match(unique(paste0(COAD.Clinical$X_PATIENT, "-01")), COAD.Clinical$sample, nomatch = 0)
sum(COAD.T.index != 0)  # Count how many tumor samples were successfully matched
# Match normal cells by patient
COAD.N.index <- match(unique(paste0(COAD.Clinical$X_PATIENT, "-11")), COAD.Clinical$sample, nomatch = 0)
sum(COAD.N.index != 0)  # Count how many normal samples were successfully matched
# Find patients who have both tumor and normal cells
COAD.matchT.index <- match(unique(paste0(COAD.Clinical$X_PATIENT[COAD.N.index], "-01")), COAD.Clinical$sample, nomatch = 0)
cbind(COAD.Clinical$sample[COAD.matchT.index], COAD.Clinical$sample[COAD.N.index])  # Combine matched tumor-normal sample pairs
# Extract tumor patient clinical data
COAD.Clinical.T <- COAD.Clinical[COAD.T.index,]
# Identify the patient's tumor cells using GAV2
common.names <- intersect(substr(colnames(TCGA.temp), 1, 15), make.names(COAD.Clinical.T$sample))
common.names
length(common.names)  # Count common names
# Identify the patient's tumor cells using HiSeqV2
common.names2 <- intersect(substr(colnames(TCGA.temp2), 1, 15), make.names(COAD.Clinical.T$sample))
common.names2
length(common.names2)  # Count common names
# Identify the patient's normal cells using HiSeqV2
common.namesN <- intersect(substr(colnames(TCGA.temp2), 1, 15), make.names(COAD.Clinical$sample[COAD.N.index]))
common.namesN
length(common.namesN)  # Count common names
#### Analysis ####
#### 建立 DESeq2 物件 ####
library(DESeq2)
library(ggplot2)
library(pheatmap)
installed.packages(pheatmap)
install.packages("pheatmap")
library(pheatmap)
# tumor + normal counts
tumor.counts <- TCGA.temp2[, common.names2]
normal.counts <- TCGA.temp2[, common.namesN]
all.counts <- cbind(tumor.counts, normal.counts)
# 樣本資訊
sample.type <- c(rep("Tumor", length(common.names2)),
rep("Normal", length(common.namesN)))
colData <- data.frame(row.names = colnames(all.counts),
condition = sample.type)
# 建立 dds
dds <- DESeqDataSetFromMatrix(
countData = round(all.counts),  # counts 必須是整數
colData = colData,
design = ~ condition
)
View(dds)
counts(dds)
dds
counts(dds)[:1:10]
counts(dds)[,1:10]
all.counts
View(TCGA.temp2)
<<<<<<< HEAD
>>>>>>> 83a24d3 (Version 3)
=======
##### View survival_COAD_survival.txt  #####
COAD.Clinical<-read.table(file="data/survival_COAD_survival.txt",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical)
colnames(COAD.Clinical)
head(COAD.Clinical)
colSums(is.na(COAD.Clinical[colSums(is.na(COAD.Clinical)) > 0]))
##### View TCGA.COAD.sampleMap_COAD_clinicalMatrix  #####
COAD.Clinical2<-read.table(file="data/TCGA.COAD.sampleMap_COAD_clinicalMatrix",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical2)
colnames(COAD.Clinical2)
head(COAD.Clinical2[,1:10])
colSums(is.na(COAD.Clinical2[colSums(is.na(COAD.Clinical2)) > 0]))
View(COAD.Clinical2)
##### View survival_COAD_survival.txt  #####
COAD.Clinical<-read.table(file="data/survival_COAD_survival.txt",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical)
colnames(COAD.Clinical)
head(COAD.Clinical)
colSums(is.na(COAD.Clinical[colSums(is.na(COAD.Clinical)) > 0]))
##### View TCGA.COAD.sampleMap_COAD_clinicalMatrix  #####
COAD.Clinical2<-read.table(file="data/TCGA.COAD.sampleMap_COAD_clinicalMatrix",sep="\t",head=TRUE,quote = "\"")
dim(COAD.Clinical2)
colnames(COAD.Clinical2)
head(COAD.Clinical2[,1:10])
colSums(is.na(COAD.Clinical2[colSums(is.na(COAD.Clinical2)) > 0]))
#### TCGA.COAD.sampleMap_HiSeqV2 AND TCGA.COAD.sampleMap_GAV2 ####
TCGA.temp2<-read.table(file="data/TCGA.COAD.sampleMap_HiSeqV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp2[,1:10])
TCGA.temp<-read.table(file="data/TCGA.COAD.sampleMap_GAV2.data",sep="\t",head=TRUE,quote = "\"")
head(TCGA.temp[,1:10])
dim(TCGA.temp)
dim(TCGA.temp2)
>>>>>>> 19d151a (Version 4)
